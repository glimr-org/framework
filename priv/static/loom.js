var L={wsPath:"/loom/ws",reconnectInterval:1000,maxReconnectAttempts:10,defaultDebounce:150},e=["click","input","change","submit","keydown","keyup","focus","blur"];var zz=11;function Dz(z,J){var Q=J.attributes,Z,j,$,V,S;if(J.nodeType===zz||z.nodeType===zz)return;for(var B=Q.length-1;B>=0;B--)if(Z=Q[B],j=Z.name,$=Z.namespaceURI,V=Z.value,$){if(j=Z.localName||j,S=z.getAttributeNS($,j),S!==V){if(Z.prefix==="xmlns")j=Z.name;z.setAttributeNS($,j,V)}}else if(S=z.getAttribute(j),S!==V)z.setAttribute(j,V);var k=z.attributes;for(var K=k.length-1;K>=0;K--)if(Z=k[K],j=Z.name,$=Z.namespaceURI,$){if(j=Z.localName||j,!J.hasAttributeNS($,j))z.removeAttributeNS($,j)}else if(!J.hasAttribute(j))z.removeAttribute(j)}var y,Uz="http://www.w3.org/1999/xhtml",G=typeof document>"u"?void 0:document,Kz=!!G&&"content"in G.createElement("template"),Oz=!!G&&G.createRange&&"createContextualFragment"in G.createRange();function kz(z){var J=G.createElement("template");return J.innerHTML=z,J.content.childNodes[0]}function Rz(z){if(!y)y=G.createRange(),y.selectNode(G.body);var J=y.createContextualFragment(z);return J.childNodes[0]}function xz(z){var J=G.createElement("body");return J.innerHTML=z,J.childNodes[0]}function bz(z){if(z=z.trim(),Kz)return kz(z);else if(Oz)return Rz(z);return xz(z)}function E(z,J){var Q=z.nodeName,Z=J.nodeName,j,$;if(Q===Z)return!0;if(j=Q.charCodeAt(0),$=Z.charCodeAt(0),j<=90&&$>=97)return Q===Z.toUpperCase();else if($<=90&&j>=97)return Z===Q.toUpperCase();else return!1}function Fz(z,J){return!J||J===Uz?G.createElement(z):G.createElementNS(J,z)}function Tz(z,J){var Q=z.firstChild;while(Q){var Z=Q.nextSibling;J.appendChild(Q),Q=Z}return J}function a(z,J,Q){if(z[Q]!==J[Q])if(z[Q]=J[Q],z[Q])z.setAttribute(Q,"");else z.removeAttribute(Q)}var Jz={OPTION:function(z,J){var Q=z.parentNode;if(Q){var Z=Q.nodeName.toUpperCase();if(Z==="OPTGROUP")Q=Q.parentNode,Z=Q&&Q.nodeName.toUpperCase();if(Z==="SELECT"&&!Q.hasAttribute("multiple")){if(z.hasAttribute("selected")&&!J.selected)z.setAttribute("selected","selected"),z.removeAttribute("selected");Q.selectedIndex=-1}}a(z,J,"selected")},INPUT:function(z,J){if(a(z,J,"checked"),a(z,J,"disabled"),z.value!==J.value)z.value=J.value;if(!J.hasAttribute("value"))z.removeAttribute("value")},TEXTAREA:function(z,J){var Q=J.value;if(z.value!==Q)z.value=Q;var Z=z.firstChild;if(Z){var j=Z.nodeValue;if(j==Q||!Q&&j==z.placeholder)return;Z.nodeValue=Q}},SELECT:function(z,J){if(!J.hasAttribute("multiple")){var Q=-1,Z=0,j=z.firstChild,$,V;while(j)if(V=j.nodeName&&j.nodeName.toUpperCase(),V==="OPTGROUP"){if($=j,j=$.firstChild,!j)j=$.nextSibling,$=null}else{if(V==="OPTION"){if(j.hasAttribute("selected")){Q=Z;break}Z++}if(j=j.nextSibling,!j&&$)j=$.nextSibling,$=null}z.selectedIndex=Q}}},O=1,Qz=11,Zz=3,jz=8;function A(){}function gz(z){if(z)return z.getAttribute&&z.getAttribute("id")||z.id}function vz(z){return function(Q,Z,j){if(!j)j={};if(typeof Z==="string")if(Q.nodeName==="#document"||Q.nodeName==="HTML"){var $=Z;Z=G.createElement("html"),Z.innerHTML=$}else if(Q.nodeName==="BODY"){var V=Z;Z=G.createElement("html"),Z.innerHTML=V;var S=Z.querySelector("body");if(S)Z=S}else Z=bz(Z);else if(Z.nodeType===Qz)Z=Z.firstElementChild;var B=j.getNodeKey||gz,k=j.onBeforeNodeAdded||A,K=j.onNodeAdded||A,Vz=j.onBeforeElUpdated||A,Mz=j.onElUpdated||A,_z=j.onBeforeNodeDiscarded||A,R=j.onNodeDiscarded||A,Iz=j.onBeforeElChildrenUpdated||A,Lz=j.skipFromChildren||A,t=j.addChild||function(q,Y){return q.appendChild(Y)},f=j.childrenOnly===!0,w=Object.create(null),x=[];function b(q){x.push(q)}function r(q,Y){if(q.nodeType===O){var H=q.firstChild;while(H){var W=void 0;if(Y&&(W=B(H)))b(W);else if(R(H),H.firstChild)r(H,Y);H=H.nextSibling}}}function F(q,Y,H){if(_z(q)===!1)return;if(Y)Y.removeChild(q);R(q),r(q,H)}function u(q){if(q.nodeType===O||q.nodeType===Qz){var Y=q.firstChild;while(Y){var H=B(Y);if(H)w[H]=Y;u(Y),Y=Y.nextSibling}}}u(Q);function c(q){K(q);var Y=q.firstChild;while(Y){var H=Y.nextSibling,W=B(Y);if(W){var X=w[W];if(X&&E(Y,X))Y.parentNode.replaceChild(X,Y),T(X,Y);else c(Y)}else c(Y);Y=H}}function Az(q,Y,H){while(Y){var W=Y.nextSibling;if(H=B(Y))b(H);else F(Y,q,!0);Y=W}}function T(q,Y,H){var W=B(Y);if(W)delete w[W];if(!H){var X=Vz(q,Y);if(X===!1)return;else if(X instanceof HTMLElement)q=X,u(q);if(z(q,Y),Mz(q),Iz(q,Y)===!1)return}if(q.nodeName!=="TEXTAREA")Sz(q,Y);else Jz.TEXTAREA(q,Y)}function Sz(q,Y){var H=Lz(q,Y),W=Y.firstChild,X=q.firstChild,D,M,U,v,_;z:while(W){v=W.nextSibling,D=B(W);while(!H&&X){if(U=X.nextSibling,W.isSameNode&&W.isSameNode(X)){W=v,X=U;continue z}M=B(X);var C=X.nodeType,I=void 0;if(C===W.nodeType){if(C===O){if(D){if(D!==M)if(_=w[D])if(U===_)I=!1;else{if(q.insertBefore(_,X),M)b(M);else F(X,q,!0);X=_,M=B(X)}else I=!1}else if(M)I=!1;if(I=I!==!1&&E(X,W),I)T(X,W)}else if(C===Zz||C==jz){if(I=!0,X.nodeValue!==W.nodeValue)X.nodeValue=W.nodeValue}}if(I){W=v,X=U;continue z}if(M)b(M);else F(X,q,!0);X=U}if(D&&(_=w[D])&&E(_,W)){if(!H)t(q,_);T(_,W)}else{var n=k(W);if(n!==!1){if(n)W=n;if(W.actualize)W=W.actualize(q.ownerDocument||G);t(q,W),c(W)}}W=v,X=U}Az(q,X,M);var o=Jz[q.nodeName];if(o)o(q,Y)}var P=Q,g=P.nodeType,d=Z.nodeType;if(!f){if(g===O)if(d===O){if(!E(Q,Z))R(Q),P=Tz(Q,Fz(Z.nodeName,Z.namespaceURI))}else P=Z;else if(g===Zz||g===jz)if(d===g){if(P.nodeValue!==Z.nodeValue)P.nodeValue=Z.nodeValue;return P}else P=Z}if(P===Z)R(Q);else{if(Z.isSameNode&&Z.isSameNode(P))return;if(T(P,Z,f),x)for(var s=0,wz=x.length;s<wz;s++){var N=w[x[s]];if(N)F(N,N.parentNode,!1)}}if(!f&&P!==Q&&Q.parentNode){if(P.actualize)P=P.actualize(Q.ownerDocument||G);Q.parentNode.replaceChild(P,Q)}return P}}var Cz=vz(Dz),qz=Cz;function Yz(z,J){if(z&&z.startsWith("ws"))return z;let Q=J.protocol==="https:"?"wss:":"ws:",Z=z||L.wsPath;return`${Q}//${J.host}${Z}`}function $z(z){return{prevent:z.dataset.lPrevent==="true",stop:z.dataset.lStop==="true",shouldDebounce:z.dataset.lDebounce!==void 0,debounce:parseInt(z.dataset.lDebounce||"")||L.defaultDebounce}}function Wz(z){let J={},Q=z.target;if(Q.value!==void 0)J.value=Q.value;if(Q.type==="checkbox"||Q.type==="radio")J.checked=Q.checked;if(z.key!==void 0)J.key=z.key;return J}function Xz(){let z=document.activeElement,J=z,Q=!!z&&(z.tagName==="INPUT"||z.tagName==="TEXTAREA");return{element:z,isInput:Q,selectionStart:J?.selectionStart??null,selectionEnd:J?.selectionEnd??null,handlerId:z?.dataset?.lInput||z?.dataset?.lChange||z?.id}}function Hz(z,J){if(!J.isInput||!J.handlerId)return;let Q=z.querySelector(`[data-l-input="${J.handlerId}"], [data-l-change="${J.handlerId}"], #${J.handlerId}`);if(!Q)return;if(Q.focus(),typeof J.selectionStart==="number"&&typeof J.selectionEnd==="number")try{Q.setSelectionRange(J.selectionStart,J.selectionEnd)}catch{}}function Pz(z){if(z.nodeType!==1)return null;let J=z;return J.dataset?.lInput||J.dataset?.lClick||J.dataset?.lChange||J.dataset?.lSubmit||J.id||null}function h(z,J){let Q="";for(let Z=0;Z<z.length;Z++)if(Q+=z[Z],Z<J.length)Q+=yz(J[Z]);return Q}function yz(z){if(typeof z==="string")return z;if(Array.isArray(z))return z.map((J)=>h(J.s,J.d)).join("");if(z&&typeof z==="object"&&"s"in z&&"d"in z)return h(z.s,z.d);return""}function Gz(z,J){if(!J||!z)return;for(let Q of Object.keys(J)){let Z=parseInt(Q,10),j=J[Q];if(typeof j==="string")z[Z]=j;else if(Array.isArray(j))z[Z]=j;else if(j&&typeof j==="object"){if("s"in j&&"d"in j)z[Z]=j;else if("d"in j){let $=z[Z];if($&&typeof $==="object"){if(Array.isArray($))Bz($,j.d);else if("d"in $)m($,j.d)}}}}}function m(z,J){if(!J||!z.d)return;for(let Q of Object.keys(J)){let Z=parseInt(Q,10),j=J[Q];if(typeof j==="string")z.d[Z]=j;else if(Array.isArray(j))z.d[Z]=j;else if(j&&typeof j==="object"){if("s"in j&&"d"in j)z.d[Z]=j;else if("d"in j){let $=z.d[Z];if($&&typeof $==="object"){if(Array.isArray($))Bz($,j.d);else if("d"in $)m($,j.d)}}}}}function Bz(z,J){if(!J)return;for(let Q of Object.keys(J)){let Z=parseInt(Q,10),j=J[Q];if(j&&typeof j==="object"){if("s"in j&&"d"in j)z[Z]=j;else if("d"in j){if(z[Z]&&typeof z[Z]==="object"&&"d"in z[Z])m(z[Z],j.d)}}}}var i=new WeakMap;class p{container;module;token;wsUrlOverride;socket=null;reconnectAttempts=0;connected=!1;initialized=!1;pendingEvents=[];statics=null;dynamics=null;constructor(z){this.container=z,this.module=z.dataset.lLive,this.token=z.dataset.lToken,this.wsUrlOverride=z.dataset.lWs||null,this.connect(),this.attachEventListeners()}connect(){let z=Yz(this.wsUrlOverride,window.location);this.socket=new WebSocket(z),this.socket.onopen=()=>{console.log("[Loom] Connected:",this.module),this.connected=!0,this.reconnectAttempts=0,this.sendInit()},this.socket.onmessage=(J)=>{this.handleMessage(JSON.parse(J.data))},this.socket.onclose=()=>{console.log("[Loom] Disconnected:",this.module),this.connected=!1,this.initialized=!1,this.attemptReconnect()},this.socket.onerror=(J)=>{console.error("[Loom] WebSocket error:",J)}}sendInit(){this.socket.send(JSON.stringify({type:"init",module:this.module,token:this.token})),this.initialized=!0;while(this.pendingEvents.length>0)this.send(this.pendingEvents.shift())}attemptReconnect(){if(this.reconnectAttempts>=L.maxReconnectAttempts){console.error("[Loom] Max reconnect attempts reached");return}this.reconnectAttempts++;let z=L.reconnectInterval*Math.pow(2,this.reconnectAttempts-1);console.log(`[Loom] Reconnecting in ${z}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{if(!this.connected)this.connect()},z)}send(z){if(this.connected&&this.initialized&&this.socket?.readyState===WebSocket.OPEN)this.socket.send(JSON.stringify(z));else this.pendingEvents.push(z)}handleMessage(z){switch(z.type){case"trees":this.statics=z.s,this.dynamics=z.d;break;case"patch":if(this.statics&&this.dynamics){Gz(this.dynamics,z.d);let J=h(this.statics,this.dynamics);this.applyPatch(J)}break;case"redirect":window.location.href=z.url;break;case"error":console.error("[Loom] Server error:",z.error);break;default:console.warn("[Loom] Unknown message type:",z.type)}}applyPatch(z){let J=Xz(),Q=document.createElement("div");Q.innerHTML=z,qz(this.container,Q,{childrenOnly:!0,getNodeKey:Pz,onBeforeElUpdated:(Z,j)=>{if(Z===J.element&&J.isInput)j.value=Z.value;return!0}}),this.attachEventListeners(),Hz(this.container,J)}attachEventListeners(){this.container.querySelectorAll("[data-l-click], [data-l-input], [data-l-change], [data-l-submit], [data-l-keydown], [data-l-keyup], [data-l-focus], [data-l-blur]").forEach((J)=>this.attachElementListeners(J))}attachElementListeners(z){if(z._loomAttached)return;z._loomAttached=!0;let J=$z(z);e.forEach((Q)=>{let Z=z.dataset[`l${Q.charAt(0).toUpperCase()+Q.slice(1)}`];if(!Z)return;z.addEventListener(Q,(j)=>{this.handleEvent(j,Q,Z,J)})})}handleEvent(z,J,Q,Z){if(Z.prevent)z.preventDefault();if(Z.stop)z.stopPropagation();let j={handler:Q,event:J,special_vars:Wz(z)};if(Z.shouldDebounce)this.debouncedSend(z.target,j,Z.debounce);else this.send(j)}debouncedSend(z,J,Q){clearTimeout(i.get(z)),i.set(z,setTimeout(()=>{i.delete(z),this.send(J)},Q))}destroy(){if(this.socket)this.socket.close(),this.socket=null;this.connected=!1,this.initialized=!1}}var l=()=>{let z=document.querySelectorAll("[data-l-live]");z.forEach((J)=>{if(J._loomInstance)return;J._loomInstance=new p(J)}),console.log(`[Loom] Initialized ${z.length} live component(s)`)};l();window.Loom={init:l,reinit:l,LoomLive:p,CONFIG:L};
